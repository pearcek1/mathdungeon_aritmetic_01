<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Visual Fractions Game</title>
  <style>
    :root { --card: #f7f7f9; --ink: #222; --muted: #666; }
    body { font-family: Arial, sans-serif; color: var(--ink); display: grid; place-items: center; min-height: 100vh; margin: 0; background: #fff; }
    .app { width: min(720px, 92vw); background: #fff; }
    .card { background: var(--card); border-radius: 16px; padding: 20px; box-shadow: 0 6px 18px rgba(0,0,0,0.08); }
    h1 { margin: 0 0 12px 0; font-size: 22px; }
    .hint { color: var(--muted); margin-bottom: 12px; }
    .board { display: grid; place-items: center; background: #fff; border-radius: 12px; padding: 12px; }
    svg { width: 420px; height: 320px; max-width: 100%; }
    .controls { display: flex; gap: 8px; margin-top: 12px; }
    input[type="text"] { flex: 1; padding: 10px 12px; font-size: 16px; border: 1px solid #ddd; border-radius: 10px; }
    button { padding: 10px 14px; font-size: 16px; border: 0; border-radius: 10px; cursor: pointer; background: #3a7bfd; color: #fff; }
    button.secondary { background: #e1e6f9; color: #2e3a5e; }
    .feedback { margin-top: 10px; min-height: 24px; }
    .ok { color: #137333; }
    .warn { color: #b26a00; }
    .err { color: #b00020; }
    .meta { margin-top: 8px; color: var(--muted); font-size: 14px; }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <h1>What fraction is shaded?</h1>
      <div class="hint">Enter your answer as <b>numerator/denominator</b> (e.g., <code>3/4</code>). Equivalent fractions are accepted.</div>
      <div class="board">
        <svg id="scene" viewBox="0 0 420 320" aria-label="fraction shape"></svg>
      </div>
      <div class="controls">
        <input id="answer" type="text" placeholder="e.g. 3/4" autocomplete="off" />
        <button id="checkBtn">Check</button>
        <button id="newBtn" class="secondary" title="Skip / New problem">New</button>
      </div>
      <div id="feedback" class="feedback"></div>
      <div id="meta" class="meta"></div>
    </div>
  </div>

  <script>
    // -------- Helpers --------
    const scene = document.getElementById('scene');
    const answerEl = document.getElementById('answer');
    const feedbackEl = document.getElementById('feedback');
    const metaEl = document.getElementById('meta');

    function gcd(a, b) {
      a = Math.abs(a); b = Math.abs(b);
      while (b) [a, b] = [b, a % b];
      return a || 1;
    }
    function simplify(n, d) {
      const g = gcd(n, d);
      return [n / g, d / g];
    }
    function parseFraction(text) {
      if (typeof text !== 'string') return null;
      const cleaned = text.replace(/\s+/g, '');
      const m = cleaned.match(/^(-?\d+)\/(-?\d+)$/);
      if (!m) return null;
      let n = parseInt(m[1], 10);
      let d = parseInt(m[2], 10);
      if (d === 0) return null;
      // Normalize sign to numerator
      if (d < 0) { n = -n; d = -d; }
      return [n, d];
    }
    function randInt(min, max) { // inclusive
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    // -------- Problem state --------
    let denom = 1;
    let numer = 0;
    let shapeType = 'pie'; // or 'grid'

    function newProblem() {
      // Denominator: 2..12
      denom = randInt(2, 12);
      // Numerator: 1..denom-1 (proper fraction)
      numer = randInt(1, denom - 1);

      // Random shape: 50/50
      shapeType = Math.random() < 0.5 ? 'pie' : 'grid';

      drawProblem();
      feedbackEl.textContent = '';
      feedbackEl.className = 'feedback';
      //metaEl.textContent = `Shaded: ${numer}/${denom}`;
      answerEl.value = '';
      answerEl.focus();
    }

    // -------- Drawing --------
    function drawProblem() {
      scene.innerHTML = ''; // clear
      // Draw soft frame
      const frame = document.createElementNS('http://www.w3.org/2000/svg','rect');
      frame.setAttribute('x', 10);
      frame.setAttribute('y', 10);
      frame.setAttribute('width', 400);
      frame.setAttribute('height', 300);
      frame.setAttribute('rx', 16);
      frame.setAttribute('fill', '#ffffff');
      frame.setAttribute('stroke', '#e6e6e6');
      scene.appendChild(frame);

      if (shapeType === 'pie') {
        drawPie(210, 170, 110, numer, denom);
      } else {
        // Choose a grid close to square factoring of denom
        const [rows, cols] = bestGrid(denom);
        drawGrid(70, 50, 280, 220, rows, cols, numer);
      }
    }

    function bestGrid(d) {
      // Find factor pair (r,c) minimizing |r-c|
      let best = [1, d], bestDiff = d - 1;
      for (let r = 1; r <= Math.sqrt(d); r++) {
        if (d % r === 0) {
          const c = d / r;
          const diff = Math.abs(r - c);
          if (diff < bestDiff) {
            best = [r, c];
            bestDiff = diff;
          }
        }
      }
      return best;
    }

    function drawGrid(x, y, w, h, rows, cols, shadedCount) {
      const cellW = w / cols;
      const cellH = h / rows;

      // Order cells left-to-right, top-to-bottom; shade first N
      const shadedSet = new Set([...Array(shadedCount).keys()]);

      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          const idx = r * cols + c;
          const rect = document.createElementNS('http://www.w3.org/2000/svg','rect');
          rect.setAttribute('x', x + c * cellW);
          rect.setAttribute('y', y + r * cellH);
          rect.setAttribute('width', cellW - 1);
          rect.setAttribute('height', cellH - 1);
          rect.setAttribute('fill', shadedSet.has(idx) ? '#88aafc' : '#f1f3f8');
          rect.setAttribute('stroke', '#cfd6ea');
          rect.setAttribute('stroke-width', 1);
          scene.appendChild(rect);
        }
      }
      // Outline
      const outline = document.createElementNS('http://www.w3.org/2000/svg','rect');
      outline.setAttribute('x', x);
      outline.setAttribute('y', y);
      outline.setAttribute('width', w);
      outline.setAttribute('height', h);
      outline.setAttribute('fill', 'none');
      outline.setAttribute('stroke', '#8b97b8');
      outline.setAttribute('stroke-width', 2);
      scene.appendChild(outline);
    }

    function drawPie(cx, cy, r, shaded, total) {
      const full = 2 * Math.PI;
      const step = full / total;
      // Shade contiguous slice arc from 0
      for (let i = 0; i < total; i++) {
        const a0 = i * step - Math.PI / 2;       // start angle (top)
        const a1 = (i + 1) * step - Math.PI / 2; // end angle
        const x0 = cx + r * Math.cos(a0);
        const y0 = cy + r * Math.sin(a0);
        const x1 = cx + r * Math.cos(a1);
        const y1 = cy + r * Math.sin(a1);
        const largeArc = (a1 - a0) > Math.PI ? 1 : 0;

        const path = document.createElementNS('http://www.w3.org/2000/svg','path');
        const d = [
          `M ${cx} ${cy}`,
          `L ${x0} ${y0}`,
          `A ${r} ${r} 0 ${largeArc} 1 ${x1} ${y1}`,
          'Z'
        ].join(' ');
        path.setAttribute('d', d);
        path.setAttribute('fill', i < shaded ? '#88aafc' : '#f1f3f8');
        path.setAttribute('stroke', '#8b97b8');
        path.setAttribute('stroke-width', 1);
        scene.appendChild(path);
      }
      // Outer circle stroke for crisp edge
      const circle = document.createElementNS('http://www.w3.org/2000/svg','circle');
      circle.setAttribute('cx', cx);
      circle.setAttribute('cy', cy);
      circle.setAttribute('r', r);
      circle.setAttribute('fill', 'none');
      circle.setAttribute('stroke', '#8b97b8');
      circle.setAttribute('stroke-width', 2);
      scene.appendChild(circle);
    }

    // -------- Checking --------
    function checkAnswer() {
      const raw = answerEl.value.trim();
      const parsed = parseFraction(raw);
      const [sn, sd] = simplify(numer, denom);

      if (!parsed) {
        feedbackEl.textContent = 'Please enter a valid fraction like 3/4.';
        feedbackEl.className = 'feedback err';
        return;
      }
      const [n, d] = parsed;
      if (n <= 0 || d <= 0) {
        feedbackEl.textContent = 'Use positive fractions like 3/4.';
        feedbackEl.className = 'feedback err';
        return;
      }
      const [an, ad] = simplify(n, d);

      if (an === sn && ad === sd) {
        // Correct (possibly simplified)
        if (n === sn && d === sd) {
          feedbackEl.textContent = '✅ Correct!';
          feedbackEl.className = 'feedback ok';
        } else {
          feedbackEl.innerHTML = `✅ Correct (equivalent). Tip: simplify to <b>${sn}/${sd}</b>.`;
          feedbackEl.className = 'feedback warn';
        }
        // Generate a fresh problem after a short beat
        setTimeout(newProblem, 700);
      } else {
        feedbackEl.textContent = '❌ Not quite. Look again at the shaded parts.';
        feedbackEl.className = 'feedback err';
      }
    }

    // -------- Events --------
    document.getElementById('checkBtn').addEventListener('click', checkAnswer);
    document.getElementById('newBtn').addEventListener('click', newProblem);
    answerEl.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') checkAnswer();
    });

    // Start
    newProblem();
  </script>
</body>
</html>
